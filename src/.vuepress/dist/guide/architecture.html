<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Architecture | Phenix framework</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Phenix framework documentation">
    <meta name="theme-color" content="#0077b6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.7ca956bd.css" as="style"><link rel="preload" href="/assets/js/app.1bb9a260.js" as="script"><link rel="preload" href="/assets/js/2.cce8fc50.js" as="script"><link rel="preload" href="/assets/js/1.cb74a9d3.js" as="script"><link rel="preload" href="/assets/js/26.504bbabc.js" as="script"><link rel="prefetch" href="/assets/js/10.6baded31.js"><link rel="prefetch" href="/assets/js/11.8ec693df.js"><link rel="prefetch" href="/assets/js/12.86f0cc65.js"><link rel="prefetch" href="/assets/js/13.c0ebf824.js"><link rel="prefetch" href="/assets/js/14.5e8377dc.js"><link rel="prefetch" href="/assets/js/15.a9be6e27.js"><link rel="prefetch" href="/assets/js/16.a100f458.js"><link rel="prefetch" href="/assets/js/17.e4b50a3d.js"><link rel="prefetch" href="/assets/js/18.7d129652.js"><link rel="prefetch" href="/assets/js/19.56a0d05b.js"><link rel="prefetch" href="/assets/js/20.87ddadca.js"><link rel="prefetch" href="/assets/js/21.50c728c6.js"><link rel="prefetch" href="/assets/js/22.b178a08c.js"><link rel="prefetch" href="/assets/js/23.35263be3.js"><link rel="prefetch" href="/assets/js/24.fa2616f0.js"><link rel="prefetch" href="/assets/js/25.c8acc927.js"><link rel="prefetch" href="/assets/js/27.d6a26548.js"><link rel="prefetch" href="/assets/js/28.d4424257.js"><link rel="prefetch" href="/assets/js/29.b4262cad.js"><link rel="prefetch" href="/assets/js/3.dd48a5c2.js"><link rel="prefetch" href="/assets/js/30.5a51e6a0.js"><link rel="prefetch" href="/assets/js/31.a855f2b6.js"><link rel="prefetch" href="/assets/js/32.3fd86b06.js"><link rel="prefetch" href="/assets/js/33.edc3ec5e.js"><link rel="prefetch" href="/assets/js/34.bf0cdaf2.js"><link rel="prefetch" href="/assets/js/35.481e1102.js"><link rel="prefetch" href="/assets/js/36.a0ac49d3.js"><link rel="prefetch" href="/assets/js/37.6ff007fa.js"><link rel="prefetch" href="/assets/js/38.d490371b.js"><link rel="prefetch" href="/assets/js/39.072f8089.js"><link rel="prefetch" href="/assets/js/4.4c3bd895.js"><link rel="prefetch" href="/assets/js/5.842b4107.js"><link rel="prefetch" href="/assets/js/6.f1b60b69.js"><link rel="prefetch" href="/assets/js/7.deca3814.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.934ed2fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7ca956bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Phenix framework</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/phenixphp/phenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/phenixphp/phenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/guide/getting_started.html" class="sidebar-link">Getting started</a></li><li><a href="/guide/architecture.html" aria-current="page" class="active sidebar-link">Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/architecture.html#php-fpm" class="sidebar-link">PHP-FPM</a></li><li class="sidebar-sub-header"><a href="/guide/architecture.html#cli-sapi" class="sidebar-link">CLI SAPI</a></li><li class="sidebar-sub-header"><a href="/guide/architecture.html#php-is-weird" class="sidebar-link">PHP is weird</a></li><li class="sidebar-sub-header"><a href="/guide/architecture.html#request-lifecycle" class="sidebar-link">Request lifecycle</a></li><li class="sidebar-sub-header"><a href="/guide/architecture.html#service-providers" class="sidebar-link">Service providers</a></li><li class="sidebar-sub-header"><a href="/guide/architecture.html#routes" class="sidebar-link">Routes</a></li></ul></li><li><a href="/guide/providers.html" class="sidebar-link">Service providers</a></li><li><a href="/guide/routing.html" class="sidebar-link">Routing</a></li><li><a href="/guide/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/guide/validation.html" class="sidebar-link">Validation</a></li><li><a href="/guide/migrations.html" class="sidebar-link">Database Migrations</a></li><li><a href="/guide/seeders.html" class="sidebar-link">Database Seeders</a></li><li><a href="/guide/query_builder.html" class="sidebar-link">Query Builder</a></li><li><a href="/guide/orm.html" class="sidebar-link">Ashes ORM</a></li><li><a href="/guide/filesystem.html" class="sidebar-link">Filesystem</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="architecture"><a href="#architecture" class="header-anchor">#</a> Architecture</h1> <h2 id="php-fpm"><a href="#php-fpm" class="header-anchor">#</a> PHP-FPM</h2> <p>There are several ways to execute a PHP script. The most popular way at the moment is PHP-FPM (FastCGI Process Manager). PHP-FPM is a server API (SAPI) for PHP that is designed to handle the execution of PHP scripts in a highly efficient manner. FPM has a main process that is responsible for receiving requests through proxied connections, for example from Nginx or Apache with the Event Multi-Processing module. This main process creates and destroys worker processes dynamically. This mechanism allows serving the traffic of a website. Each worker bootstraps the application code, then compiles it, executes it, and returns the response. FPM works very well; as developers, we don't have to worry about memory leaks. However, performance is sacrificed a little due to the bootstrapping, compilation, and execution process.</p> <p>On the other hand, there are flavors of PHP that allow you to keep the code in memory, such as Swoole, RoadRunner, and recently FrankenPHP. Laravel with its Octane package implements Swoole and RoadRunner. The strategy of these flavors is to reduce the loading process by keeping the code in memory, although at this point the specter of memory leaks appears.</p> <h3 id="server-api"><a href="#server-api" class="header-anchor">#</a> Server API</h3> <p>Server APIs (SAPI) are the types of interfaces between PHP and the server. SAPIs handle communication between web servers and PHP scripts. Some historically known SAPIs are: CGI, Apache (mod_php), FastCGI (PHP-FPM), Embedded, and CLI. Phenix is executed in the CLI (Command Line Interface) as a long-running process. Let's see some advantages of this SAPI.</p> <h2 id="cli-sapi"><a href="#cli-sapi" class="header-anchor">#</a> CLI SAPI</h2> <p>Scripting languages like Python and JavaScript with Node run their servers in the CLI. If you're wondering why, it's simply because this offers many advantages:</p> <ul><li>The interface was designed for command-line execution, making it suitable for scripting and automation tasks.</li> <li>Provides direct access to the PHP interpreter for running scripts without the need for a web server.</li> <li>Allows for easy debugging and script testing from the command line.</li> <li>Script code is kept in memory.</li> <li>PHP can now run its own production-ready server.</li></ul> <p>The Amphp ecosystem leverages the CLI and Fibers to enable asynchronous code writing, concurrent applications, and efficient resource usage. This approach allows handling a large number of concurrent fibers without wasting CPU resources.</p> <h2 id="php-is-weird"><a href="#php-is-weird" class="header-anchor">#</a> PHP is weird</h2> <p><a href="https://www.youtube.com/watch?v=ECuD_dGvxyY" target="_blank" rel="noopener noreferrer">Chris Fidao published a video<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in which he explains that the HTTP protocol is naturally stateless. He demonstrated how other languages maintain a state in consecutive requests. Effectively, PHP, like the HTTP protocol, remains stateless. But with the Amphp server running in the CLI, it allows us to maintain a state like in other programming languages. Is this good or bad for PHP? Obviously good. PHP now has all the flavors and is at the forefront of the most modern languages.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">CounterController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword type-declaration">int</span> <span class="token variable">$counter</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$counter</span><span class="token operator">++</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'counter'</span> <span class="token operator">=&gt;</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$counter</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Send requests to this controller and watch the counter increment with each request received.</p> <h3 id="coroutine-architecture"><a href="#coroutine-architecture" class="header-anchor">#</a> Coroutine architecture</h3> <p>Amphp uses a fiber-based coroutine architecture to implement asynchronous programming in PHP. Fibers are a lightweight alternative to threads that allow you to write concurrent and parallel code without the overhead of context switching. Amphp uses a single event loop to manage all of the fibers in an application. The event loop is responsible for scheduling fibers, handling I/O events, and managing timers. When a fiber needs to be executed, it is added to the event loop's queue. The event loop then executes the fibers one at a time, in the order that they were added to the queue.</p> <p>If a fiber needs to wait for something, such as a database query or a network response, it is suspended from the event loop. The event loop then continues executing other fibers until the suspended fiber is ready to resume. When a fiber is resumed, it is added to the end of the event loop's queue. This ensures that all fibers are given an equal amount of time to execute. Amphp also supports cooperative multitasking. This means that a fiber can yield control to another fiber without having to wait for the event loop to schedule it.</p> <h2 id="request-lifecycle"><a href="#request-lifecycle" class="header-anchor">#</a> Request lifecycle</h2> <p>The entry point for the application is the <code>public/index.php</code> file. In this file, the application is loaded from the <code>bootstrap/app.php</code> file, and the server is executed as a long-running process. It is kept in memory and won't be bootstrapped for each incoming request.</p> <p>Within <code>public/index.php</code>, the Composer autoloader file is loaded to manage dependencies.</p> <h2 id="service-providers"><a href="#service-providers" class="header-anchor">#</a> Service providers</h2> <p>Service providers are responsible for loading different components into the framework such as databases, file systems, and routes. Phenix uses the <a href="https://container.thephpleague.com/" target="_blank" rel="noopener noreferrer">container<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> created by PHP League. It is lightweight and powerful. You can look at the service providers that are loaded by default in the <code>config/app.php</code> file. You can find more information in the <a href="/guide/providers.html">service providers</a> section.</p> <h2 id="routes"><a href="#routes" class="header-anchor">#</a> Routes</h2> <p>The routes are loaded by the <code>Phenix\Providers\RouteServiceProvider</code> from the <code>routes/api.php</code> file. This is where you can define and organize your routes. You can find more information in the <a href="/guide/routing.html">routes</a> section.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/getting_started.html" class="prev">
        Getting started
      </a></span> <span class="next"><a href="/guide/providers.html">
        Service providers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1bb9a260.js" defer></script><script src="/assets/js/2.cce8fc50.js" defer></script><script src="/assets/js/1.cb74a9d3.js" defer></script><script src="/assets/js/26.504bbabc.js" defer></script>
  </body>
</html>
