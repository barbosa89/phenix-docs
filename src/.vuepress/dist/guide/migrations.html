<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Database migrations | Phenix framework</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Phenix framework documentation">
    <meta name="theme-color" content="#0077b6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.7ca956bd.css" as="style"><link rel="preload" href="/assets/js/app.df578006.js" as="script"><link rel="preload" href="/assets/js/2.b1069894.js" as="script"><link rel="preload" href="/assets/js/1.c5a0aea4.js" as="script"><link rel="preload" href="/assets/js/32.fc68ee04.js" as="script"><link rel="prefetch" href="/assets/js/10.3c94dfe0.js"><link rel="prefetch" href="/assets/js/11.bdc989a9.js"><link rel="prefetch" href="/assets/js/12.ae642386.js"><link rel="prefetch" href="/assets/js/13.2961dfe0.js"><link rel="prefetch" href="/assets/js/14.c139f315.js"><link rel="prefetch" href="/assets/js/15.53b58150.js"><link rel="prefetch" href="/assets/js/16.7bc071f4.js"><link rel="prefetch" href="/assets/js/17.a2ef797c.js"><link rel="prefetch" href="/assets/js/18.6d3b94c1.js"><link rel="prefetch" href="/assets/js/19.65bbcf8e.js"><link rel="prefetch" href="/assets/js/20.603ec5f7.js"><link rel="prefetch" href="/assets/js/21.d5154217.js"><link rel="prefetch" href="/assets/js/22.f05199a4.js"><link rel="prefetch" href="/assets/js/23.f0d24e67.js"><link rel="prefetch" href="/assets/js/24.24b96303.js"><link rel="prefetch" href="/assets/js/25.4ce88aa1.js"><link rel="prefetch" href="/assets/js/26.302d8adf.js"><link rel="prefetch" href="/assets/js/27.5d964fd3.js"><link rel="prefetch" href="/assets/js/28.b7bc0551.js"><link rel="prefetch" href="/assets/js/29.c7e87d7d.js"><link rel="prefetch" href="/assets/js/3.1e944e3a.js"><link rel="prefetch" href="/assets/js/30.9775bd9a.js"><link rel="prefetch" href="/assets/js/31.3c54617d.js"><link rel="prefetch" href="/assets/js/33.a5d8b1c4.js"><link rel="prefetch" href="/assets/js/34.e148e37a.js"><link rel="prefetch" href="/assets/js/35.c495686f.js"><link rel="prefetch" href="/assets/js/36.15479314.js"><link rel="prefetch" href="/assets/js/37.712b64dd.js"><link rel="prefetch" href="/assets/js/38.c3bf3233.js"><link rel="prefetch" href="/assets/js/4.94f04b6e.js"><link rel="prefetch" href="/assets/js/5.dabd7dc3.js"><link rel="prefetch" href="/assets/js/6.d9896851.js"><link rel="prefetch" href="/assets/js/7.55071482.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7ca956bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Phenix framework</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/phenixphp/phenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/phenixphp/phenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/guide/getting_started.html" class="sidebar-link">Getting started</a></li><li><a href="/guide/architecture.html" class="sidebar-link">Architecture</a></li><li><a href="/guide/providers.html" class="sidebar-link">Service providers</a></li><li><a href="/guide/routing.html" class="sidebar-link">Routing</a></li><li><a href="/guide/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/guide/migrations.html" aria-current="page" class="active sidebar-link">Database migrations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/migrations.html#writing-migrations" class="sidebar-link">Writing migrations</a></li><li class="sidebar-sub-header"><a href="/guide/migrations.html#tables" class="sidebar-link">Tables</a></li><li class="sidebar-sub-header"><a href="/guide/migrations.html#columns" class="sidebar-link">Columns</a></li><li class="sidebar-sub-header"><a href="/guide/migrations.html#indexes" class="sidebar-link">Indexes</a></li><li class="sidebar-sub-header"><a href="/guide/migrations.html#foreign-keys" class="sidebar-link">Foreign keys</a></li></ul></li><li><a href="/guide/seeders.html" class="sidebar-link">Database seeders</a></li><li><a href="/guide/query_builder.html" class="sidebar-link">Query Builder</a></li><li><a href="/guide/filesystem.html" class="sidebar-link">Filesystem</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="database-migrations"><a href="#database-migrations" class="header-anchor">#</a> Database migrations</h1> <p>Migrations add versioning to database changes over time. The migration system implemented in Phenix is based on <a href="https://phinx.org/" target="_blank" rel="noopener noreferrer">Phinx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and it is no coincidence, Phinx offers simplicity and maintainability. Migrations are stored in the <code>database/migrations</code> folder and extend the <code>Phenix\Database\Migration</code> class.</p> <h2 id="writing-migrations"><a href="#writing-migrations" class="header-anchor">#</a> Writing migrations</h2> <p>To create a migration, you can run the following Phenix command:</p> <div class="language- extra-class"><pre class="language-text"><code>php phenix make:migration CreateUserTable
</code></pre></div><p>The name of the migration must be created with the camel case style, the class will be created with the name in camel case style but the file will be created with a name composed of two parts, the date and time and the name of the migration in snake case style, example, <code>20231006144210_create_users_table</code>.</p> <ul><li>Version (time): 20231006144210</li> <li>File name: create_users_table</li> <li>Class name: CreateUserTable</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">declare</span><span class="token punctuation">(</span>strict_types<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Phenix<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Migration</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateUsersTable</span> <span class="token keyword">extends</span> <span class="token class-name">Migration</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// ..</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// ..</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>The <code>up</code> method is used to create and modify tables, add indexes and other operations, while the <code>down</code> method should reverse the operations performed by the up method.</p> <h3 id="running-migrations"><a href="#running-migrations" class="header-anchor">#</a> Running migrations</h3> <p>To run the migrations use the <code>migrate</code> command:</p> <div class="language- extra-class"><pre class="language-text"><code>php phenix migrate
</code></pre></div><h3 id="rolling-back-migrations"><a href="#rolling-back-migrations" class="header-anchor">#</a> Rolling back migrations</h3> <p>The rollback command reverts the last migration, or optionally up to a specific version:</p> <div class="language- extra-class"><pre class="language-text"><code>php phenix migrate:rollback
</code></pre></div><p>To roll back to a specific version you can use the <code>-t</code> option:</p> <p>php phenix migrate:rollback -t 20231006144210</p> <h2 id="tables"><a href="#tables" class="header-anchor">#</a> Tables</h2> <p>The <code>table</code> method allows the preparation of the table to be created, the first argument is the name of the table, the second argument is the options available in an associative array structure.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
<span class="token punctuation">{</span>
    <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>Important</strong>: The <code>id</code> column was not defined because it is automatically created as the primary key, you can indicate a specific primary key you can use the <code>primary_key</code> option to assign it.</p></blockquote> <h3 id="table-options"><a href="#table-options" class="header-anchor">#</a> Table options</h3> <table><thead><tr><th>Option</th> <th>Values</th></tr></thead> <tbody><tr><td>primary_key</td> <td><code>array</code>, <code>string</code>, <code>false</code></td></tr> <tr><td>engine</td> <td>Defaults to <code>InnoDB</code></td></tr> <tr><td>collation</td> <td>Defaults to <code>utf8mb4_unicode_ci</code></td></tr> <tr><td>signed</td> <td>Defaults to <code>false</code></td></tr></tbody></table> <h3 id="checking-if-exists"><a href="#checking-if-exists" class="header-anchor">#</a> Checking if exists</h3> <p>The <code>hasTable</code> method allows you to verify the existence of a table in the database.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">hasTable</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// code</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dropping-tables"><a href="#dropping-tables" class="header-anchor">#</a> Dropping tables</h3> <p>To drop a table we can use the <code>drop</code> method, for the operation to be executed we must invoke the <code>save</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="rename-tables"><a href="#rename-tables" class="header-anchor">#</a> Rename tables</h3> <p>To rename tables we can use the <code>rename</code> method and invoke the <code>update</code> method so that the change takes effect.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'legacy_users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="columns"><a href="#columns" class="header-anchor">#</a> Columns</h2> <p>The <code>addColumn</code> method allows adding columns to the table to be created, the data type and additionally configuration options.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span>
<span class="token punctuation">{</span>
    <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="column-types"><a href="#column-types" class="header-anchor">#</a> Column types</h3> <p>These are the supported data types for columns:</p> <ul><li>binary</li> <li>boolean</li> <li>char</li> <li>date</li> <li>datetime</li> <li>decimal</li> <li>float</li> <li>double</li> <li>smallinteger</li> <li>integer</li> <li>biginteger</li> <li>string</li> <li>text</li> <li>time</li> <li>timestamp</li> <li>uuid</li></ul> <p>In addition, the MySQL adapter supports <code>enum</code>, <code>set</code>, <code>blob</code>,
<code>tinyblob</code>, <code>mediumblob</code>, <code>longblob</code>, <code>bit</code> and <code>json</code> column types
(<code>json</code> in MySQL 5.7 and above). When providing a limit value and using
<code>binary</code>, <code>varbinary</code> or <code>blob</code> and its subtypes, the retained column
type will be based on required length (see <a href="#limit-option-and-mysql">Limit Option and
MySQL</a> for details);</p> <p>In addition, the Postgres adapter supports <code>interval</code>, <code>json</code>, <code>jsonb</code>,
<code>uuid</code>, <code>cidr</code>, <code>inet</code> and <code>macaddr</code> column types (PostgreSQL 9.3 and
above).</p> <h4 id="column-options"><a href="#column-options" class="header-anchor">#</a> Column options</h4> <p>For any column type:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>limit</td> <td>set maximum length for strings, also hints column types in adapters (see note below)</td></tr> <tr><td>length</td> <td>alias for <code>limit</code></td></tr> <tr><td>default</td> <td>set default value or action</td></tr> <tr><td>null</td> <td>allow <code>NULL</code> values, defaults to false if <span class="title-ref">identity</span> option is set to true, else defaults to true</td></tr> <tr><td>after</td> <td>specify the column that a new column should be placed after, or use <code>\Phinx\Db\Adapter\MysqlAdapter::FIRST</code> to place the column at the start of the table <em>(only applies to MySQL)</em></td></tr> <tr><td>comment</td> <td>set a text comment on the column</td></tr></tbody></table> <p>For <code>decimal</code> columns:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>precision</td> <td>combine with <code>scale</code> set to set decimal accuracy</td></tr> <tr><td>scale</td> <td>combine with <code>precision</code> to set decimal accuracy</td></tr> <tr><td>signed</td> <td>enable or disable the <code>unsigned</code> option <em>(only applies to MySQL)</em></td></tr></tbody></table> <p>For <code>enum</code> and <code>set</code> columns:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>values</td> <td>Can be a comma separated list or an array of values</td></tr></tbody></table> <p>For <code>smallinteger</code>, <code>integer</code> and <code>biginteger</code> columns:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>identity</td> <td>enable or disable automatic incrementing</td></tr> <tr><td>signed</td> <td>enable or disable the <code>unsigned</code> option <em>(only applies to MySQL)</em></td></tr></tbody></table> <p>For Postgres, when using <code>identity</code>, it will utilize the <code>serial</code> type
appropriate for the integer size, so that <code>smallinteger</code> will give you
<code>smallserial</code>, <code>integer</code> gives <code>serial</code>, and <code>biginteger</code> gives
<code>bigserial</code>.</p> <p>For <code>timestamp</code> columns:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>default</td> <td>set default value (use with <code>CURRENT_TIMESTAMP</code>)</td></tr> <tr><td>update</td> <td>set an action to be triggered when the row is updated (use with <code>CURRENT_TIMESTAMP</code>) <em>(only applies to MySQL)</em></td></tr> <tr><td>timezone</td> <td>enable or disable the <code>with time zone</code> option for <code>time</code> and <code>timestamp</code> columns <em>(only applies to Postgres)</em></td></tr></tbody></table> <p>For <code>boolean</code> columns:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>signed</td> <td>enable or disable the <code>unsigned</code> option <em>(only applies to MySQL)</em></td></tr></tbody></table> <p>For <code>string</code> and <code>text</code> columns:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>collation</td> <td>set collation that differs from table defaults <em>(only applies to MySQL)</em></td></tr> <tr><td>encoding</td> <td>set character set that differs from table defaults <em>(only applies to MySQL)</em></td></tr></tbody></table> <p>For foreign key definitions:</p> <table><thead><tr><th>Option</th> <th>Description</th></tr></thead> <tbody><tr><td>update</td> <td>set an action to be triggered when the row is updated</td></tr> <tr><td>delete</td> <td>set an action to be triggered when the row is deleted</td></tr> <tr><td>constraint</td> <td>set a name to be used by foreign key constraint</td></tr></tbody></table> <h3 id="checking-if-column-exists"><a href="#checking-if-column-exists" class="header-anchor">#</a> Checking if column exists</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$column</span> <span class="token operator">=</span> <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">hasColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// code</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="renaming-a-column"><a href="#renaming-a-column" class="header-anchor">#</a> Renaming a column</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'username'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="adding-column-after-another"><a href="#adding-column-after-another" class="header-anchor">#</a> Adding column after another</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'city'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'after'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="dropping-a-column"><a href="#dropping-a-column" class="header-anchor">#</a> Dropping a column</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">removeColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'nickname'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="indexes"><a href="#indexes" class="header-anchor">#</a> Indexes</h2> <p>Indexes are used to improve the performance of database queries by speeding up data retrieval. They serve as data structures that provide fast access to specific rows within database tables. By creating an index on one or more columns, the database can quickly locate the desired data without having to scan the entire table, resulting in significant query optimization.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addIndex</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More about indexes: <a href="https://book.cakephp.org/phinx/0/en/migrations.html#working-with-indexes" target="_blank" rel="noopener noreferrer">Indexes in deep<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="foreign-keys"><a href="#foreign-keys" class="header-anchor">#</a> Foreign keys</h2> <p>To add foreign keys we can use the <code>addForeignKey</code> method, the first argument is the name of the foreign key, the second argument is the name of the related table, and the third argument is the column that refers to the foreign key, the fourth argument is the configuration options.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">addForeignKey</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'delete'</span><span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'SET_NULL'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update'</span><span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'NO_ACTION'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>More about foreign keys: <a href="https://book.cakephp.org/phinx/0/en/migrations.html#working-with-foreign-keys" target="_blank" rel="noopener noreferrer">Foreign keys in deep<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/controllers.html" class="prev">
        Controllers
      </a></span> <span class="next"><a href="/guide/seeders.html">
        Database seeders
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.df578006.js" defer></script><script src="/assets/js/2.b1069894.js" defer></script><script src="/assets/js/1.c5a0aea4.js" defer></script><script src="/assets/js/32.fc68ee04.js" defer></script>
  </body>
</html>
